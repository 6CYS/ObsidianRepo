# 3.3 核心对话交互


## F-CHAT-01 自然语言提问

### 需求描述
用户与系统的核心交互入口，支持灵活的提问方式。

### 功能要点
1. **语义输入**：支持自由文本输入，具备一定的容错性与模糊匹配能力。
2. **交互式标注 (#)**：智能检测用户输入的“#”字符，**弹出场景相关的 Schema/表/字段列表**，用户点击后自动填充并带上语义标签，辅助模型精准对齐。
3. **多轮对话**：具备 Memory 机制，能够理解类似“那去年呢？”等基于上文的补全式提问。

---

## F-CHAT-02 流式响应 (Streaming)

### 需求描述
优化回复体验，通过打字机效果让用户尽快感知系统正在处理。

### 功能要点
1. **递向输出**：将模型生成的文字块实时推送到前端显示。
2. **状态指示**：在完全输出前，显示“正在思考中...”等加载提示。

---

## F-CHAT-03 思维链可视化 (Thinking Bubble)

### 需求描述
提升 AI 的可信度，将隐藏的思考过程透明化。

### 功能要点
1. **内容提取**：捕获 DeepSeek 等模型返回的 `<think>` 标签内容。
2. **交互设计**：回复顶部默认展示一个折叠的“Thinking...”气泡，用户可自主点击展开查看详细的推理链路。

---

## F-CHAT-04 意图识别与路由

### 需求描述
智能判断用户的原始诉求，分配到最适合的处理引擎。

### 功能要点
1. **语义分类**：区分“SQL 查询”、“数据分析建议”、“普通日常闲聊”。
2. **精准分流**：若是数据查询，则强制路由至 WrenAI Core 引擎进行处理。

---

## F-CHAT-05 追问与修正

### 需求描述
允许用户对结果进行迭代与打磨。

### 功能要点
1. **逻辑接龙**：基于上轮的表格结果，直接输入“按地区汇总”即可实现即时重排。
2. **SQL 辅助修正**：当生成的 SQL 不符预期时，支持用自然语言指出错误（如“不要包含上海的数据”），模型自动修正逻辑。

---

## F-CHAT-06 智能体规划过程展示

### 需求描述
展示 Agent 内部的自动化流转过程。

### 功能要点
1. **步骤明示**：在回复前，以进度条或步骤列表形式展示规划进度：
   - [x] 识别业务意图
   - [x] 检索语义 Schema
   - [ ] 正在编写分析代码...
2. **透明处理**：让用户感知后台复杂的处理逻辑（意图识别 -> 元数据筛选 -> 代码生成 -> 安全审计）。

---

## F-CHAT-07 推荐后续问题

### 需求描述
提问并得到回答之后，智能推荐后续可能的查询或分析方向，引导用户深入洞察。

### 功能要点
1. **自动生成**：系统在给出回答后，根据当前对话上下文和查询结果，自动推荐 3 个相关的延伸向问题。
2. **交互选择**：推荐问题以标签或按钮形式展示，用户点击后直接触发新的一轮查询。
3. **语义关联**：推荐问题需具备逻辑连贯性，例如查询了“各地区销量”后，推荐“销量最高的地区是哪个？”或“该地区的销量趋势如何？”。
